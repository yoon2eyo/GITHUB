@startuml FaceModelServiceComponent
' FaceModelService_component.puml (DD-05: IPC-Based Performance Optimization)

package "Interface Layer" {
  interface IFaceModelServiceApi
  component FaceModelServiceApiImpl
  IFaceModelServiceApi -- FaceModelServiceApiImpl
}

package "Business Layer" {
  interface IFaceModelService
  interface IModelManagementPort
  interface IFaceModelRepository
  
  component VectorComparisonEngine
  component ModelLifecycleManager
  component FaceModelEventProcessor
  
  IFaceModelService -- VectorComparisonEngine
  IModelManagementPort -- ModelLifecycleManager
  
  ' DD-05 Pipeline Optimization:
  ' VectorComparisonEngine uses parallelized feature extraction
  ' - requestedStage: extract features (~200ms)
  ' - storedStage: extract features (~200ms)
  ' - Combined via thenCombine: parallelized to ~205ms
  ' - cosineSimilarity: vector comparison
  ' - applyThresholds: model-based post-processing
  
  VectorComparisonEngine ..( IFaceModelRepository : <<Local>>
  
  ' Hot Swap Support:
  ' ModelLifecycleManager manages activeModel (AtomicReference)
  ' - Transition: <1ms (atomic operation)
  ' - History-based rollback support
  ModelLifecycleManager ..( VectorComparisonEngine : <<IPC>>
  
  FaceModelEventProcessor ..( IFaceModelService : <<use>>
}

package "System Interface Layer" {
  interface IFaceModelRepository
  interface IModelVersionRepository
  interface IMessagePublisherService
  
  component FaceModelRepositoryImpl
  component ModelVersionRepositoryImpl
  component MessageBrokerComponent
  database VectorDatabase
  database ModelVersionDatabase
  
  IFaceModelRepository -- FaceModelRepositoryImpl
  IModelVersionRepository -- ModelVersionRepositoryImpl
  IMessagePublisherService -- MessageBrokerComponent
  
  FaceModelRepositoryImpl ..( VectorDatabase : <<JDBC>>
  ModelVersionRepositoryImpl ..( ModelVersionDatabase : <<JDBC>>
}

' External connections
FaceModelServiceApiImpl ..( IFaceModelService : <<HTTP>>
FaceModelServiceApiImpl ..( IFaceModelRepository : <<Local>>

' Business to System Interface
VectorComparisonEngine ..( IFaceModelRepository : <<JDBC>>
ModelLifecycleManager ..( IModelVersionRepository : <<JDBC>>
FaceModelEventProcessor ..( IMessagePublisherService : <<RabbitMQ>>

note top of VectorComparisonEngine
  **DD-05 Pipeline Optimization**
  
  Performance Metrics:
  • Feature Extraction: ~200ms (parallel)
  • Vector Matching: ~150ms (parallel)
  • Combined: max(200, 150) = ~205ms
  • vs Sequential: 400ms
  • Improvement: 49% latency reduction ✅
  
  Tactics Applied:
  - Introduce Concurrency (CompletableFuture)
  - Data Pre-Fetching (cache integration)
  - Shared Memory (IPC optimization)
  - Hot Swap (atomic model switching)
end note

@enduml
OtherServices --> ServiceApi : calls (vector operations)

' Data Persistence
FaceRepoImpl --> VectorDB : reads/writes
ModelRepoImpl --> ModelDB : reads/writes

' Message Broker
EventProcessor --> Broker : subscribes
Broker --> EventProcessor : publishes events

' Port Interfaces
ServiceApiImpl --> FaceRepo : uses
ServiceApiImpl --> ModelRepo : uses

' Internal ML Engine Integration
ModelManager --> PanDokuService : deployModel()
ModelManager --> PanDokuService : trainModel()
ModelManager --> PanDokuService : monitorModel()
ModelManager --> PanDokuService : getModelStatus()

note right of ServiceApi
  External API for face verification
  - calculateSimilarityScore()
  - verifyFace()
  - registerFaceVector()
  - getSavedFaceVectors()
end note

note right of PanDokuService
  Internal ML Engine for model lifecycle
  - deployModel(): Deploy new model versions
  - trainModel(): Train models with datasets
  - monitorModel(): Monitor performance
  - getModelStatus(): Get deployment status
end note


note right of VectorEngine
  Core algorithm: Cosine similarity
  - calculateSimilarityScore()
  - createVerificationResult()
  - isModelLoaded()
end note

note right of ModelManager
  Model lifecycle management
  - loadNewModel()
  - rollbackToPreviousModel()
  - getActiveModelVersion()
  - getModelMetadata()
end note

note right of Root
  Singleton DI Container
  Manages component lifecycle
  and dependency injection
end note

@enduml
