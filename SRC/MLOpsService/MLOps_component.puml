@startuml MLOps Component Diagram

' 기본 설정
!pragma layout smetana
allowmixing
skinparam componentStyle rectangle
skinparam backgroundColor transparent
skinparam packageStyle rectangle
skinparam portStyle solid
skinparam interfaceStyle rectangle

package "MLOps Core" {
    ' Interface Layer (Ports)
    package "Interface Layer" {
        interface "IAuthRepository" as IAuth {
            + findRecentlyRegisteredUsers(sinceDate: Date): List<UserAccount>
        }
        interface "IHelperRepository" as IHelper {
            + findConfirmedTasksForRetraining(): List<HelperTask>
        }
        interface "ITrainingTriggerService" as ITrainTrig {
            + triggerDailyBatch(timestamp: Date): void
        }
        interface "IFaceModelClient" as IFaceClient {
            + callHotSwapApi(modelId: String, newVersion: String, modelBinary: byte[]): void
            + callRollbackApi(modelId: String, previousVersion: String): void
        }
        interface "IModelDataRepository" as IModelRepo {
            + saveRawTrainingData(type: String, data: byte[]): void
            + loadAllTrainingData(): List<byte[]>
            + saveModelBinary(modelId: String, version: String, bin: byte[]): void
            + loadModelBinary(modelId: String, version: String): Optional<byte[]>
        }
    }

    package "Adapter Layer" {
        component "AuthRepositoryAdapter" as AuthAdapter
        component "HelperRepositoryAdapter" as HelperAdapter
    }

    ' Service Layer
    package "Service Layer" {
        component "TrainingManager" as TrainingManager
        component "DataCollector" as DataCollector
        component "DeploymentService" as DeployService
    }

    ' Storage Layer
    package "Storage Layer" {
        component "ModelDataRepository" as ModelRepo

        database "DS-05\nAI Training Dataset" as DS05
    }

    ' Domain Model (Data Transfer Objects)
    package "Domain Layer" {
        class "UserAccount" as UserAccount
        class "HelperTask" as HelperTask
    }

    ' Domain Model Usage
    IAuth ..> UserAccount : uses
    IHelper ..> HelperTask : uses

    ' 외부 통신 포트
    portin "auth_data_in" as auth_port
    portin "helper_data_in" as helper_port
    portin "training_trigger_in" as train_port
    portout "face_model_api_out" as face_port
}

' External Components
component "Auth Service" as AuthService
component "Helper Service" as HelperService
component "Face Model Service" as FaceModel
actor "Scheduler" as Scheduler

' Internal Relationships
TrainingManager ..|> ITrainTrig
TrainingManager --> DataCollector : "collectDailyTrainingData()"
TrainingManager --> DeployService : "executeZeroDowntimeDeployment()"
TrainingManager -( IModelRepo
AuthAdapter ..|> IAuth
HelperAdapter ..|> IHelper
DataCollector -( IAuth
DataCollector -( IHelper
DataCollector -( IModelRepo
DeployService -( IFaceClient
DeployService -( IModelRepo
ModelRepo --> DS05

' External Relationships
AuthService --> auth_port
HelperService --> helper_port
Scheduler --> train_port
face_port --> FaceModel
auth_port --> AuthAdapter : "read-only export"
helper_port --> HelperAdapter : "read-only export"
train_port --> ITrainTrig
IFaceClient --> face_port

' Notes
note right of DataCollector
  Collects training data daily
  from multiple sources
  via read-only adapters
end note

note right of TrainingManager
  Orchestrates batch training,
  verification, deployment
end note

note right of DeployService
  Implements Hot Swap deployment
  with automatic rollback
end note

note right of ModelRepo
  Manages AI model versions
  and training datasets
end note

legend right
  MLOps Service Components
  - Daily Batch Training (ITrainingTriggerService)
  - Zero-Downtime Deployment (IFaceModelClient)
  - Model Version Management (IModelDataRepository)
  - Training Data Collection (IAuth/IHelper via adapters)
end legend

@enduml
