@startuml
!pragma layout smetana
allowmixing
skinparam componentStyle rectangle
skinparam backgroundColor transparent
skinparam packageStyle rectangle
skinparam portStyle solid
skinparam interfaceStyle rectangle

title MLOps Service - Component Diagram

package "MLOps Service" as MLOps {

  package "Ports" {
    interface "ITrainingTriggerService" as ITrainingTriggerService
    interface "IAuthRepository" as IAuthRepository
    interface "IHelperRepository" as IHelperRepository
    interface "IFaceModelClient" as IFaceModelClient
    interface "IModelDataRepository" as IModelDataRepository {
      + saveRawTrainingData(type: String, data: byte[])
      + loadAllTrainingData(): List<byte[]>
      + saveModelBinary(modelId: String, version: String, bin: byte[])
      + loadModelBinary(modelId: String, version: String): Optional<byte[]>
    }
  }

  package "Adapters" {
    component "AuthRepositoryAdapter" as AuthRepositoryAdapter
    component "HelperRepositoryAdapter" as HelperRepositoryAdapter
  }

  package "Service Layer" {
    component "TrainingManager" as TrainingManager
    component "DataCollector" as DataCollector
    component "DeploymentService" as DeploymentService
  }

  package "Storage" {
    component "ModelDataRepository" as ModelDataRepository
    database "DS-05\nTraining Dataset" as DS05
  }

  package "Domain" {
    class "UserAccount" as UserAccount
    class "HelperTask" as HelperTask
  }
}

package "External Systems" {
  component "RemoteAuthDataClient" as RemoteAuthDataClient
  component "RemoteHelperDataClient" as RemoteHelperDataClient
  component "Face Model Service" as FaceModelService
}

actor "Scheduler" as Scheduler

' Port implementations
TrainingManager ..|> ITrainingTriggerService
AuthRepositoryAdapter ..|> IAuthRepository
HelperRepositoryAdapter ..|> IHelperRepository
ModelDataRepository ..|> IModelDataRepository

' Dependencies within service
TrainingManager --> DataCollector : collectDailyTrainingData()
TrainingManager --> DeploymentService : executeZeroDowntimeDeployment()
TrainingManager -( IModelDataRepository

DataCollector -( IAuthRepository
DataCollector -( IHelperRepository
DataCollector -( IModelDataRepository

DeploymentService -( IFaceModelClient
DeploymentService -( IModelDataRepository

ModelDataRepository --> DS05

' Adapter dependencies on external clients
AuthRepositoryAdapter --> RemoteAuthDataClient
HelperRepositoryAdapter --> RemoteHelperDataClient
DeploymentService --> FaceModelService : via IFaceModelClient

' External interactions
Scheduler --> ITrainingTriggerService : triggerDailyBatch()
RemoteAuthDataClient --> AuthRepositoryAdapter : export (read-only)
RemoteHelperDataClient --> HelperRepositoryAdapter : export (read-only)
IFaceModelClient --> FaceModelService : hot swap / rollback

' Domain usage
IAuthRepository ..> UserAccount : returns
IHelperRepository ..> HelperTask : returns

legend right
  MLOps service structure
  - TrainingManager implements ITrainingTriggerService
  - DataCollector pulls read-only data via repository adapters
  - ModelDataRepository owns DS-05 storage and provides binaries
  - DeploymentService calls IFaceModelClient for hot swap / rollback
end legend

@enduml
